<!doctype html>
<html>
  <head>
    <title>Huntinality Round 3</title>
    <link rel="shortcut icon" type="image/x-icon" href="../scripts_etc/favicon.ico">
    <link rel="stylesheet" type="text/css" href="style.css"/>
    <meta charset='UTF-8'>
  </head>
  <body>
    <h2>Way more than anyone wants to know about Round 3</h2>
    <p>Caveat 1: This post is about Round 3 of Huntinality. Huntinality is a puzzle hunt (now over) run by the team Cardinality, which I am a member of, and viewable at <a target="_blank" rel="noopener noreferrer" href="https://huntinality.com">https://huntinality.com</a>. I have a very ‚Äúthe information you want is probably somewhere in here because everything is somewhere in here‚Äù writing style, but I hope this is well-organized enough that if you're wondering about a specific thing you can find it quickly enough.</p>
    <p>Caveat 2: I had finals about 2-3 weeks before hunt starts. Others picked up a lot of slack then. Thus, stuff done then isn't brought up as much, and this document is a lot more focused on stuff I personally did than the actual round is. The character images and audio are especially glossed over. I say "we" almost everywhere unless something was very especially my responsibility (reading through, it looks like the stupid decisions, e.g. the initially impossibly hard minipuzzles, were me and the good decisions/fixing of the stupid decisions were everyone else).</p>
    <h4>Game design</h4>
    <p>Generally speaking, this game owes the most to <a target="_blank" rel="noopener noreferrer" href="https://ivark.github.io">Antimatter Dimensions</a>, for which I am a tester, and to a lesser extent <a target="_blank" rel="noopener noreferrer" href="https://pseudonian.github.io/SynergismOfficial">Synergism</a> and <a target="_blank" rel="noopener noreferrer" href="https://orteil.dashnet.org/cookieclicker/">Cookie Clicker</a>. The UI layout generally is pretty similar to that of Antimatter Dimensions (grids of buttons/achievements, a table of producers of the main currency).</p>
    <ul>
      <li>
        Main:
        <p>This tab has the news (text scrolling across the top), WarioCoins, boosts, miners, accelerants, and kickstarters. News is a feature of some but not all incremental games (including Cookie Clicker and Antimatter Dimensions), in which often fairly nonsensical messages scroll across the top of the screen. To make each puzzle correspond to a tab, we decided to put news in the main tab only (unlike, say, Antimatter Dimensions, in which it is always visible unless you disable it). The basic pre-prestige way WarioCoins/miners work is more similar to Cookie Clicker or early Synergism than to Antimatter Dimensions, in that each producer produces the primary currency rather than another producer. Also as in Synergism, there are at first no multipliers to a producer for buying more of it. We made these choices to make the start of the game fairly easy for teams to understand (rather than having confusing multipliers coming out of nowhere.)</p>
        <p>The fact that there are 8 producers is largely due to Antimatter Dimensions also having 8. (To a lesser extent, it's due to there being 8 minipuzzles and a general theme around 8.) Something like boosts (a multiplier with exponential cost increase) is also a common feature in many incremental games (accelerators and multipliers in Synergism, tickspeed in Antimatter Dimensions).</p>
        <p>The basic idea of accelerants and kickstarters (a secondary currency, with generators you can buy by paying currency you get from resets, which boosts the gain of the primary currency) is fairly typical (it exists in Antimatter Dimensions and Synergism, though in both those cases there are multiple generators similarly to how there are multiple miners in this game). Something like the upgrade to boost the accelerant multiplier exponent also exists in Synergism (crystal upgrade 4).</p>
      </li>
      <li>Help: Many incremental games (as with other games) have built-in help. We initially had a ton of stuff in this tab, including descriptions of game features (partially in an effort to make scrolling down harder, which was a bad idea), but those descriptions were deleted or moved next to the feature. In the end, we put some very basic useful guidance here and made it pretty short.</li>
      <li>Achievements: Almost all incremental games have some form of achievements, usually providing a bonus to production based on achievements gotten. Many games have "secret achievements", including Antimatter Dimensions, which, in addition to regular achievements, has 3 rows of secret achievements without rewards (each with 8 achievements, as with the rows of regular achievements). Antimatter Dimensions lets you see the names of these secret achievements, but not how to get them, before you have them; we decided to reverse this and show how to get achievements before you have them, but not their names, which also fit well into the puzzle. We went with a mix of progress-measuring (e.g., liquidate) and somewhat weird achievements (e.g., 11 of each miner), which is fairly common in incremental games.</li>
      <li>Options: This tab is fairly minimal, with only the basic save/load options and notation (how numbers are displayed). (Some games, like Antimatter Dimensions, have a lot of notations, some, like Cookie Clicker, have a few, and some, like Synergism, don't let you choose at all.) Save/load is a bit different than in most games; there's no in-game way to get the savestate string or to load a savestate from a string (as many games have) to make getting the savestate string and trying to cheat with it slightly harder. However, there is a way to save to server and to choose which save to load when you load a save, which is fairly atypical (most incremental games have only one save, stored in browser; some, including Antimatter Dimensions, allow for several saves but it's harder to switch between them). We decided to have only 2 notations because that was all that was needed for the puzzle (in an earlier version of the puzzle there were 3, but that changed due to feedback from others); we recognized that introducing unneeded information would not end well.</li>
      <li>Minigame: This game feature was inspired by Cookie Clicker's golden cookies, which provide temporary multipliers to production when clicked. Initially clickable things automatically showed up every few minutes and provided a multiplier to production until the next one; they could be sped up and their boost could be increased. After some iteration on this concept, aided by a lot of testing several options by a lot of people, we got to the current state of clickable things only showing up when you were playing a free minigame and each giving a certain number of seconds of production. This meant that playing the minigame provided a fairly large boost to production, the consequences of which will be described later. Even though this has nothing to do with liquidation or Goombas, we only showed this tab after first liquidation because we wanted teams not to be overwhelmed early on.</li>
      <li>Autobuyers: Most incremental games eventually have autobuyers of some form. (This includes Antimatter Dimensions and Synergism, but surprisingly not Cookie Clicker.) Given the existence of liquidation and the general number of things to do in the game, fairly good autobuyers were necessary to avoid teams needing to do tons of clicking on miners. We went with the simplest option of having autobuyers have no delay once unlocked, rather than making them, for example, initially only tick every second (but we made them possible to turn on/off so that certain achievements would be possible). We originally unlocked autobuyers slightly later than they currently unlock (all post-liquidation), but out of considerations of puzzle placement (wanting more early puzzles) and reducing required manual miner buying, we made it possible to unlock them all pre-liquidation.</li>
      <li>Tasks: This is fairly atypical for an incremental game. Some somewhat less-known incremental games, such as Sandcastle Builder and Technomancy, have truth-lie logic puzzles within the game, but we don't know of any games that have grid puzzles. These will be discussed further later, because it's basically all puzzle content.</li>
      <li>Upgrades: Having a prestige layer (here liquidation) and one-time upgrades that cost prestige currency (here Goomba upgrades) is fairly typical in incremental games (all of Antimatter Dimensions, Synergism, and Cookie Clicker). These upgrades were actually inspired by some pre-prestige upgrades in Synergism that multiply production of a single type of generator by a multiplier exponential in number of generators bought. We reversed this relationship, which gives it a slightly different dynamic, and made the first upgrade be based on all generators so that it'd be best and prestige would start off fairly quickly and as a clear bonus. The 2x multiplier per Goomba upgrade was added for balance reasons, and the multiplier to all production based on Goombas was added so that even with all the Goomba upgrades (or at points where the next Goomba upgrade wasn't immediately in reach), there'd be a clear reason to liquidate to get more Goombas.</li>
    </ul>
    <h4>Math of the game</h4>
    <p>Our basic idea was to have a number of multipliers that were polynomial in WarioCoins (that is, WarioCoins to some small power) that didn't quite multiply out to WarioCoins itself, and some smaller multipliers that only grew logarithmically or were constant to fill the gap. The multipliers which are polynomial in WarioCoins are boosts (roughly WarioCoins^0.3), the Goomba upgrade multipliers (slightly more than WarioCoins^0.4), and the multiplier from unspent Goombas (WarioCoins^(1/6)). The remainder was roughly WarioCoins^0.1 (times a constant factor), in which all the other multipliers (for example, accelerants, achievements, tasks) fit. This basic balancing scheme was there more or less from the start. The most important balancing change was probably to remove a large multiplier from solved puzzles (10^(number of solved puzzles)). We did this because the first few testers found that not having the multiplier made progress very annoying if you weren't solving puzzles. The main compensation for this multiplier removal was an increase in the exponent on the multiplier from unspent Goombas. Since the game was also originally too slow, there were also other increases to constant multipliers, such as an increase to the per-achievement multiplier and a 2x multiplier per Goomba upgrade.</p>
    <p>The rest of this section is some random math notes, without much organization. Hopefully if you have a math question about the game it's answered somewhere in them.</p>
    <p>Accelerants and kickstarters weren't used in any puzzle; they were added to avoid the optimal liquidation strategy being to liquidate as fast as possible. Without them, WarioCoin gain, and thus Goomba gain, would for a long time be too slow to support long liquidations as a viable strategy. (The formula for Goomba gain is (highest WarioCoins held at once this liquidation / 1e10)^(1/3), which requires WarioCoin gain to be cubic to support long liquidations. This does eventually happen but it requires almost all the Goomba upgrades.) However, since accelerants reset on liquidation, WarioCoin gain over a liquidation has a faster growth rate and long liquidations become viable. However, since you still have to liquidate sometimes, these "long liquidations" don't become longer than a few minutes until after 1e100 WarioCoins, where the puzzle unlocks end.</p>
    <p>An oft-asked question is when to spend Goombas and when not to. The production multiplier from Goombas is proportional to their square root. Since most things you buy with Goombas have a significant effect, spending Goombas on something is usually good unless it costs 90% or more of your Goombas. However, kickstarters are fairly weak, so buying them whenever you can is not so wise (as an achievement name eventually says). You get an overall multiplier of about (1 - fraction of Goombas spent on 1 kickstarter / 2)(1 + accelerant effect power / number of kickstarters) per kickstarter (first term from production multiplier from Goombas, second term from extra accelerants), so you want (fraction of goombas spent on 1 kickstarter / 2) to be (accelerant effect power / number of kickstarters). In reality, you don't lose that much from letting fraction of goombas spent on 1 kickstarter be 1 / number of kickstarters (it's not exactly optimal but if you look at the actual numbers it ends up being within a few percent of optimal). In fact, you can even not buy kickstarters at all for quite some time and it could be hard to notice. However, a lot of this is moot before 1e100 because buy max is the quickest option and isn't a catastrophe, so when you're rushing through everything it's preferable.</p>
    <p>Goomba upgrades give boosts exponential in number of miners of certain types, as has been mentioned above. This means that pretty quickly, the main criterion in buying a miner below Miner 8 is whether you have a Goomba upgrade giving a boost based on it. Indeed, far enough into the game, the main advantage of buying even Miner 8 is the extra Goomba upgrade multipliers, rather than the direct extra WarioCoin production.</p>
    <p>The initial miner properties are initial costs powers of 10 (from 10 until 1e8), cost increases 1.11, 1.12, ..., 1.18, and production per purchase per second 1, 5, 25, ..., 5^7. This meant that once boosts become affordable, getting enough WarioCoins to get the next miner is more or less a repeating pattern (until you get Miner 8); the next miner costs 10x as much, exactly compensated for by the 5x extra production and the 2x boost.</p>
    <h4>Endgame</h4>
    <p>A lot of teams got over 1e200 WarioCoins, which takes a few hours. The top team got around 1e234. The JS Javascript builtin number limit is slightly above 1e308, which we knew would take several months to reach manually (from our testing it), so we weren't too worried about teams reaching this limit. Above 1e120, the game reaches a sufficiently slow pace that the optimal strategy for progress is mostly playing the WarioCoin minigame over and over, because even though it's hard to play the minigame and do something else at the same time, there's almost nothing else to do in the game. This is fairly active, boring, time-consuming, and soul-crushing, and some teams complained about it. (This is kind of a metaphor for real-world cryptocurrency mining, except that's done by computers rather than people, but we weren't really thinking of it as such when we made the puzzle). Also, we learned that the minigame does not work on mobile; we didn't know this before but weren't shocked, and we didn't know exactly what to do to fix it or want to take the risk of breaking something else at the same time. In the end, we hoped that the minigame being necessary to be at the top of the leaderboard didn't sour anyone's experience.</p>
    <h4>Puzzles</h4>
    <p>The puzzles are described in unlock order. We first thought of places we could put puzzle content (even before really thinking about the game itself), then put puzzles there while making the game.</p>
    <ul>
      <li>Assistance: We wanted some type of puzzle on the help page, since it (like any long textual thing) seemed like an easy place to put puzzle content. Common characters in two lines seemed like a reasonable extraction mechanism, especially with some of the text cluing it. The idea of having the slight extra difficulty of one of the lines being hidden came from similarly hidden text I had recently put in an incremental game. (If you're curious, <a target="_blank" rel="noopener noreferrer" href="https://dan-simon.github.io/misc/fe000000">FE000000</a>, a game I made, sometimes (based on current time) has a link in the Infinity Challenge tab to a vaguely Infinity-Corridor themed puzzle I made a month or so before we started work on Round 3, <a style="cursor: default; color: black; text-decoration: none;" target="_blank" rel="noopener noreferrer" href="https://dan-simon.github.io/misc/reduction/ic">[include clickability]</a>, hidden in much the same way that the bottom line of help text was hidden. I like hiding things with HTML, though maybe I should try something new instead of hidden text, such as links that look like regular text. Anyway, this puzzle has not been successfully solved yet as far as I know and it might be impossible, so definitely be ready to take a few hours if you want to try and potentially yell at me for making it too hard.) Initially we were unsure if we wanted to make the bottom line less full of typos (not sure if anyone else was thinking about doing this) but after some successful testsolves with the typos, we decided not to put in the effort to try to get rid of them. In retrospect, most teams in testsolving had the idea of common characters but did not do it accurately at first (usually missing the H) and so tried other stuff (mostly extracting from the typos somehow) before eventually finding the letter they missed, but it wasn't bad enough for us to regret not removing the typos.
      <li>Headlines: News, also being textual, seemed like another easy place to put a puzzle. We decided to do a cryptic clue puzzle, with some extra non-clue text around the cryptic clues so that they could all make more sense and be at least somewhat fittingly described by the ultimate answer, and with ordering given by some of the other text. This is a pretty vanilla cryptic clue puzzle without anything weird about the clues. The fact that this puzzle involves cryptics (not everyone's taste) and the other puzzle that's unlocked initially is easy to make a subtle mistake on was a bit unideal, because neither initial puzzles was especially clear and easy, but there were more puzzles unlocked soon after so it wasn't a huge issue.</li>
      <li>Automation: We knew we wanted to do a puzzle based around costs of something, and we ended up using costs of autobuyers. Factoring seemed like a neat thing to do with numbers, so we based it around that, but autobuyer costs couldn't be so cheap as to all be less than 1e4, so we multiplied by powers of 10. Initially, autobuyer costs were formatted normally, but to make this minipuzzle easier we left the costs unformatted based on suggestions from the first few testsolvers. The fact that the answer phrase could be spelled out without any type of reordering (just using the lower prime first) was a neat feature that we was surprised by as we constructed this minipuzzle.</li>
      <li>üí©: Some incremental games have various notations in which numbers can be represented. I'm an intermittent maintainer of the notations library <a target="_blank" rel="noopener noreferrer" href="https://github.com/antimatter-dimensions/notations">Antimatter Dimensions Notations</a>. Unsurprisingly, I really like the concept of notations and wish there were more puzzles with the general idea of representing numbers in some way that the solver has to figure out (despite being unable to solve 1000...0003 from MITMH 2021, despite a fair amount of staring during Mystery Hunt, which is pretty close to being such a puzzle). This minipuzzle basically just uses Cancer Notation from Antimatter Dimensions, and that's it (just figure out how it works and convert from it). (Cancer Notation has an emoji for each power of 1e3 starting with letters of the alphabet, so angry face for 1e3, birthday cake for 1e6, christmas tree for 1e9, dead for 1e12, etc.) Initially we made this minipuzzle more elaborate, and it turned out that it was basically only solvable if you already knew about Cancer Notation. After testsolving showed it to be far far too hard it entered a process of difficulty adjustment and ended up where it is now. Some teams happened to know about Cancer Notation and thus had an easier-than-usual time with this minipuzzle, but as expected almost all did not. (We did modify Cancer Notation a bit fairly late in this minipuzzle's development; since üí© is used as the title of the minipuzzle, we used üêß instead for 1e48.)</li>
      <li>Just Click It: Given the widespread knowledge of Cookie Clicker compared to other incremental games, we wanted a reference to it, and clicking things that come up and look vaguely cookie-like seemed natural (even if it required some Cookie Clicker knowledge to get the reference, which was not essential to the puzzle). At first, we thought that the clickable things could look like cookies. Having round cookies seemed natural, and from there we got the idea of Morse extraction. Far later, when we made this minipuzzle more Mario-themed with coins and blocks, the Morse extraction was able to stay.</li>
      <li>Drive and Derive: Upgrade names were another place we wanted to have a puzzle. Benji had the idea of having them be one-letter off from Mario names. The ordering of the changed letters by the derivatives of position also in the name is to some extent another Antimatter Dimensions reference; with 8 dimensions, the first 8 derivatives are what's relevant for production over time in that game (though not in this game, since miners all produce coins). More generally, higher-order derivatives are relevant to many incremental games.</li>
      <li>The 'Gram: We wanted some type of non-incremental-game tasks to be embedded in the game (Cafe 5 was fresh on our minds), but didn't really talk about it and left it open. When implementing, we thus initially made this minipuzzle an infinite stream of arithmetic problems relating the digits of 4-digit numbers to each other. You had to extract from these numbers. The arithmetic problems were not fun and the extraction was hard to get, so after considering logic puzzles as an alternative, we changed this to a finite list of nonograms each shaped like a letter. We made some of the letter shapes a bit tilted or otherwise unusual to minimize the impact of teams knowing they were all letter-shaped, but they weren't intended to be too hard in the first place. We found during testing that some online nonogram solvers didn't solve some of the nonongrams, saying that they weren't unique; we wrote a primitive solver and found some other programmatic solvers, and both our solver and the other solvers verified that they were in fact unique. Sorry to any teams that got stuck on this.</li>
      <li>Feat: We wanted a puzzle in the achievements, and having a puzzle in their names seemed natural given how seemingly-random achievement names can be in some incremental games. The idea of using four-letter words came from one of our answers being composed of three four-letter words, and the current extraction method then came to mind as something constructible and somewhat impressive-seeming at first (even though it's not actually more impressive than a 4x4 word square, if not less; we wrote a program to check for possible words to extract a given word from). When we had the idea of the title being "Feat" and the flavortext having an instruction with only four-letter words, we realized that that'd make it even better.</li>
      <li>Superfinale: This was the first part of this round to be thought of; we had the meta the idea before anyone even knew what form Round 3 would take. In the first few playtests, this meta had no flavortext (or title), just an answer order and indices. One playtester (Alison) actually did eventually get this form of the meta, but we quickly realized this was insufficient and over the course of following playtests added more and more blatant hints towards "super".</li>
    </ul>
    <h4>General setup</h4>
    <p>We used Vue.js for doing UI updates every tick. We didn't do this in a particularly idiomatic way, but it worked well; we didn't get any reports of the game lagging, and all the changing numbers were correctly updated without us having to think about it that much. However, we could have used React instead, which most of the members of our team were more familiar with; we used Vue.js because I'd previously worked with it in making other similar games, but in retrospect if we do this kind of thing in the future we'll probably use React just for familiarity's sake.</p>
    <p>We didn't use any other JS libraries, except for the ubiquitous jQuery. Some typical libraries for incremental games are <a target="_blank" rel="noopener noreferrer" href="https://github.com/Patashu/break_infinity.js">break_infinity</a> (a fast big number library) and, as mentioned above <a target="_blank" rel="noopener noreferrer" href="https://github.com/antimatter-dimensions/notations">Antimatter Dimensions Notations</a>; in game design we decided not to make the numbers in the game big enough to need <a target="_blank" rel="noopener noreferrer" href="https://github.com/Patashu/break_infinity.js">break_infinity</a>, and given the game's limited notation options <a target="_blank" rel="noopener noreferrer" href="https://github.com/antimatter-dimensions/notations">Antimatter Dimensions Notations</a> rather than a hand-crafted implementation seemed like overkill.</p>
    <h4>Characters</h4>
    <p>We decided to theme this puzzle more heavily and add characters from various media to it. This got rid of some complaints about insufficient theming and allowed for more hinting at minipuzzle answers/solve paths. It did lead to some teams going down a character/puzzle association rabbit hole in testsolving, which we tried to fix by having multiple characters per puzzle in a sufficiently chaotic manner as to stop teams from concluding anything (which seems to have almost entirely worked). We also made a wonderful round art picture of even more character that we didn't include in puzzles.</p>
    <h4>Characters</h4>
    <p>The primary concern we had with having so much logic on the client-side was that someone could manipulate their gamestate to progress faster than should be possible. Obfuscating the code was mostly a means to making progress manipulation harder; the puzzle answers weren't embedded in the code, so we didn't worry extremely much about a team seeing content they hadn't unlocked (though we also didn't want it to be trivial), but being able to read the code seemed like it might also make some gamestate manipulation methods easier.</p>
    <p>Unfortunately, there were a lot of ways to manipulate gamestate. Among the ones we considered were using the console directly, using the debugger to stop the code at some breakpoint and then using the console, changing the save stored in localStorage, sending fake save HTTP requests to the server, manipulating computer time to skip waiting, and changing JS builtin methods that the game used (such as Math.pow). We only handled some of these methods, due to the round being sufficiently short that cheating would not give a team much benefit.</p>
    <p>To avoid using the console directly being helpful, we put all the code in a function closure. (During internal testing a week before the hunt, however, Akira realized that copying the inside of the function and pasting it in the console would allow for calling game functions, even if not for cheating directly.) To avoid changing the save stored in localStorage or sending fake save HTTP requests to the server being helpful, we stored saves in a way that was nontrivial to decrypt and obfuscated the save-parsing code (as with the rest of the code). Since the obfuscated code was all on one line, the easiest way to place a breakpoint in most browsers (clicking on a line of source code) didn't work, but one team, after completing the hunt, placed a breakpoint in another way, which made progress manipulation fairly easy. We didn't do anything about time manipulation (but we don't think any team used it) or, generally, JS builtin methods (however, most JS builtin methods that were used, like Math.pow, were used more than once, so changing them would be more likely to break the game or affect progress unexpectedly than do the desired thing).
    <p>As for the code obfuscation itself, we wanted to hide the many string templates in the code (used by Vue to generate elements), and to also hide game property names and function names. Since the JS obfuscation libraries we found didn't obfuscate strings, we used a JS parser/generator to generate the code's syntax tree, recursively descend through the tree renaming variables and transforming strings into concatenations of character lists, and then re-generate code from the modified syntax tree. We then ran the result through a minifier (checking by hand that it didn't undo our obfuscation) to modify the code's structure slightly more, and put it in a function closure. To obscure some especially important stuff at the start of the code, we added an implementation of the Strassen algorithm to the start of the code; this was unused, but we hoped it would distract teams that tried to read the code from the start. (Sorry for not including a more optimal matrix multiplication algorithm, but those are pretty complicated and I can write nothing at 150 LOC/h). We considered instead including apparent puzzle content that wasn't actually used, and actually added some such content at some point, but we decided this would draw teams' attention to the code and was thus a bad idea.</p>
  </body>
</html>
